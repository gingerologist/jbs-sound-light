

# 术语

OTA1，指包含wifi功能无线模块（wrover, c3 etc），在启动时搜索预设的ssid，如果找到，连接到该ssid和受控更新固件的情形，OTA1不需要蓝牙通讯协议，是强制更新固件行为，包括版本可降级；OTA1称强制升级；

OTA2，指包含bt/wifi功能的无线模块（c3），在用户部署的组网模式下，通过特别设计的通讯协议实现的固件升级，该升级行为比对固件版本，仅向新版本升级；OTA2称在线升级；





# 可交付清单

剧本杀声光电系统包含的硬件可交付产品如下：

1. 工业包装的A60智能球泡（以下简称“灯”），使用esp32-c3-mini-1模块作为主控，5路pwm调光，rgb和冷白（c）暖白（w）；
2. 工业包装的音箱网关，使用esp32-wrover和esp32-c3-mini-1模块控制，wrover模块与云通讯，负责播放音频，c3模块负责与灯组网和通讯；
3. 一体化包装，每个sku（stock keeping unit）包含：
   1. 一个音箱网关，具有唯一的二维码标识（印刷，mac地址）；
   2. 10个灯，每个灯上有唯一的编号（标贴），二维码标识（灯杯上直接喷码，mac地址）；
   3. 贴在剧本杀房间内桌面上的二维码标识（印刷，此二维码仅腾讯API可生成，无法自制）；
   4. 其它包装内物品、填充物等；
   5. 一体化包装的组装过程在上海办公室完成，该过程包含必要的固件升级，设备mac地址录入系统，设备分组和信息录入数据库功能，该过程称为“预置”（provisioning）。



包含的软件可交付产品如下：

1. 灯的固件，有两个版本：
   1. 最低量产固件，仅包含涂鸦产测要求和OTA1；
   2. 最终用户固件，包含全部功能，除涂鸦产测和OTA1外还包括灯效控制，蓝牙通讯协议，OTA2；
2. 音箱网关的wrover模块固件
   1. 最低量产固件，需包含产测要求和OTA1；
      1. 产测要求目前不清晰，音箱工厂需要调试音效因此应该有预播放的方式；
   2. 最终用户固件，包含全部功能；除产测和OTA1外，还包括所有用户场景需要的功能，包括OTA2（从云下载固件升级），包括通过串口协议强制更新
3. 音箱网关的c3模块固件
   1. 最低量产固件，产测可以测试焊接和基础无线；
   2. 最终用户固件
4. 预置软件（PC）



原型化过程中会有下述要求的固件和软件：

1. 在PC上仿真音箱的场景（下述）中，PC需要一个通过USB和PC相连，可接收指令的自制C3模块固件，该固件可看作音箱网关C3固件的前置版本；
2. 在PC上仿真音箱的场景中的PC软件；
3. 在PC上仿真云的场景中的PC软件，该软件最终会成为交付软件里的4，甚至最终可能包含composer软件（声光电效果编辑软件）的基础功能，比如可以问吧



# 场景

请所有开发人员务必理解『场景』是在多组件的复杂系统中开发调试的最重要的方法论。每一个场景都是某一类开发人员在某个时刻的实际工作场景。每个场景未必直接产出最终交付软件，但它对关键组件的原型体验与验证、开发调试、troubleshooting、核心组件测试，都至关重要；最终交付软件中的每个功能组件的开发、调试和测试工作必然在某个具体场景下完成。

在混杂部署设备、客户端软件和云服务的计算环境中，不可能开发调试在全部计算结点上都安排开发人员和调试工具配合，场景首先在很大意义上相当于包含mock（仿件）的prototyping（原型化）系统，它让开发者专注于一个局部进行开发测试工作，且对整个场景具有完全的控制能力，不真正依赖于外部系统；其次，场景会推动开发工作逐步完成每个功能组件，直至拼出完整产品的使用场景。开发工作通过一个一个完成场景的功能要求展开，如果在一个环节遇到问题，可以向前回溯和测试依赖组件，检查是设计问题还是实现问题，让产品工程过程中一直有很好的可测试性，避免直接集成诸多难以独立测试的组件，这会导致联调和集成测试的工作量以几何级数增加，而这一点是没有必要的。



## 仿灯

仿灯是一块PCB板，电路原理和产品灯接口一致，板载rgb冷白暖白LED，插5V USB供电，方便调试，原理上也和Devkit C3类似。

仿灯首先用于调试灯的固件中的通讯协议和灯效功能部分；其次可用于仿真音箱网关中的C3模块，包括串口升级。



